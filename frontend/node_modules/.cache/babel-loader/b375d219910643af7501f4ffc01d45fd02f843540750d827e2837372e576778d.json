{"ast":null,"code":"// MessagesList/MessagesList.js\nimport React,{useRef,useEffect,useCallback}from\"react\";import classNames from\"classnames/bind\";import styles from\"./MessageList.module.scss\";import MessageContent from\"../MessageContent/MessageContent\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const cx=classNames.bind(styles);function MessagesList(_ref){let{messages,loading,error,isLoadingMore,hasMore,onLoadMore,onImagePreview}=_ref;const messagesContainerRef=useRef(null);const formatTime=dateObj=>{return dateObj.toLocaleTimeString(\"vi-VN\",{hour:\"2-digit\",minute:\"2-digit\",hour12:true});};const formatSeparator=dateObj=>{return dateObj.toLocaleDateString(\"vi-VN\",{day:\"2-digit\",month:\"2-digit\",year:\"numeric\"})+\" \"+formatTime(dateObj);};const scrollToBottom=useCallback(()=>{if(messagesContainerRef.current){messagesContainerRef.current.scrollTop=messagesContainerRef.current.scrollHeight;}},[]);const handleScroll=useCallback(()=>{const container=messagesContainerRef.current;if(!container)return;if(container.scrollTop<=100&&hasMore&&!isLoadingMore&&!loading){onLoadMore();}},[hasMore,isLoadingMore,loading,onLoadMore]);useEffect(()=>{const container=messagesContainerRef.current;if(container){container.addEventListener(\"scroll\",handleScroll);return()=>container.removeEventListener(\"scroll\",handleScroll);}},[handleScroll]);useEffect(()=>{if(messages.length>0){const lastMessage=messages[messages.length-1];const previousLastMessageId=localStorage.getItem('lastMessageId');if(!previousLastMessageId||previousLastMessageId!==lastMessage.id.toString()){scrollToBottom();localStorage.setItem('lastMessageId',lastMessage.id.toString());}}},[messages.length,scrollToBottom]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:cx(\"center\"),ref:messagesContainerRef,children:/*#__PURE__*/_jsx(\"div\",{children:\"\\u0110ang t\\u1EA3i...\"})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:cx(\"center\"),ref:messagesContainerRef,children:/*#__PURE__*/_jsx(\"div\",{className:cx(\"error\"),children:error})});}return/*#__PURE__*/_jsxs(\"div\",{className:cx(\"center\"),ref:messagesContainerRef,children:[isLoadingMore&&/*#__PURE__*/_jsx(\"div\",{className:cx(\"loading-more\"),children:\"\\u0110ang t\\u1EA3i th\\xEAm tin nh\\u1EAFn...\"}),messages.map((message,index)=>{const prevMsg=messages[index-1];const nextMsg=messages[index+1];const currentTime=message.timestamp;let showSeparator=false;let showTime=false;if(!prevMsg){showSeparator=true;}else{const diffMinutes=(currentTime-prevMsg.timestamp)/1000/60;if(diffMinutes>=10){showSeparator=true;}}if(!nextMsg){showTime=true;}else{const sameMinute=currentTime.getHours()===nextMsg.timestamp.getHours()&&currentTime.getMinutes()===nextMsg.timestamp.getMinutes();if(!sameMinute){showTime=true;}}return/*#__PURE__*/_jsxs(\"div\",{className:cx(\"message-wrapper\",message.type),children:[showSeparator&&/*#__PURE__*/_jsx(\"div\",{className:cx(\"time-separator\"),children:/*#__PURE__*/_jsx(\"div\",{className:cx(\"time-separator-content\"),children:formatSeparator(message.timestamp)})}),/*#__PURE__*/_jsxs(\"div\",{className:cx(\"message\",message.type),children:[/*#__PURE__*/_jsx(\"div\",{className:cx(\"message-bubble\",{\"has-media\":message.temporaryImage||message.image||message.temporaryVideo||message.video||message.file,temporary:message.isTemporary,uploading:message.uploading}),children:/*#__PURE__*/_jsx(MessageContent,{message:message,onImagePreview:onImagePreview})}),showTime&&/*#__PURE__*/_jsx(\"div\",{className:cx(\"message-time\"),children:formatTime(message.timestamp)})]})]},message.id);})]});}export default MessagesList;","map":{"version":3,"names":["React","useRef","useEffect","useCallback","classNames","styles","MessageContent","jsx","_jsx","jsxs","_jsxs","cx","bind","MessagesList","_ref","messages","loading","error","isLoadingMore","hasMore","onLoadMore","onImagePreview","messagesContainerRef","formatTime","dateObj","toLocaleTimeString","hour","minute","hour12","formatSeparator","toLocaleDateString","day","month","year","scrollToBottom","current","scrollTop","scrollHeight","handleScroll","container","addEventListener","removeEventListener","length","lastMessage","previousLastMessageId","localStorage","getItem","id","toString","setItem","className","ref","children","map","message","index","prevMsg","nextMsg","currentTime","timestamp","showSeparator","showTime","diffMinutes","sameMinute","getHours","getMinutes","type","temporaryImage","image","temporaryVideo","video","file","temporary","isTemporary","uploading"],"sources":["/home/ichigomazone/Vscode/ReactJs/new-ui/frontend/src/components/Chat/MessageList/MessageList.js"],"sourcesContent":["// MessagesList/MessagesList.js\nimport React, { useRef, useEffect, useCallback } from \"react\";\nimport classNames from \"classnames/bind\";\nimport styles from \"./MessageList.module.scss\";\nimport MessageContent from \"../MessageContent/MessageContent\";\n\nconst cx = classNames.bind(styles);\n\nfunction MessagesList({ \n  messages, \n  loading, \n  error, \n  isLoadingMore, \n  hasMore, \n  onLoadMore, \n  onImagePreview \n}) {\n  const messagesContainerRef = useRef(null);\n\n  const formatTime = (dateObj) => {\n    return dateObj.toLocaleTimeString(\"vi-VN\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      hour12: true,\n    });\n  };\n\n  const formatSeparator = (dateObj) => {\n    return (\n      dateObj.toLocaleDateString(\"vi-VN\", { day: \"2-digit\", month: \"2-digit\", year: \"numeric\" }) +\n      \" \" +\n      formatTime(dateObj)\n    );\n  };\n\n  const scrollToBottom = useCallback(() => {\n    if (messagesContainerRef.current) {\n      messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;\n    }\n  }, []);\n\n  const handleScroll = useCallback(() => {\n    const container = messagesContainerRef.current;\n    if (!container) return;\n    \n    if (container.scrollTop <= 100 && hasMore && !isLoadingMore && !loading) {\n      onLoadMore();\n    }\n  }, [hasMore, isLoadingMore, loading, onLoadMore]);\n\n  useEffect(() => {\n    const container = messagesContainerRef.current;\n    if (container) {\n      container.addEventListener(\"scroll\", handleScroll);\n      return () => container.removeEventListener(\"scroll\", handleScroll);\n    }\n  }, [handleScroll]);\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      const lastMessage = messages[messages.length - 1];\n      const previousLastMessageId = localStorage.getItem('lastMessageId');\n      if (!previousLastMessageId || previousLastMessageId !== lastMessage.id.toString()) {\n        scrollToBottom();\n        localStorage.setItem('lastMessageId', lastMessage.id.toString());\n      }\n    }\n  }, [messages.length, scrollToBottom]);\n\n  if (loading) {\n    return (\n      <div className={cx(\"center\")} ref={messagesContainerRef}>\n        <div>Đang tải...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={cx(\"center\")} ref={messagesContainerRef}>\n        <div className={cx(\"error\")}>{error}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={cx(\"center\")} ref={messagesContainerRef}>\n      {isLoadingMore && (\n        <div className={cx(\"loading-more\")}>Đang tải thêm tin nhắn...</div>\n      )}\n      \n      {messages.map((message, index) => {\n        const prevMsg = messages[index - 1];\n        const nextMsg = messages[index + 1];\n        const currentTime = message.timestamp;\n\n        let showSeparator = false;\n        let showTime = false;\n\n        if (!prevMsg) {\n          showSeparator = true;\n        } else {\n          const diffMinutes = (currentTime - prevMsg.timestamp) / 1000 / 60;\n          if (diffMinutes >= 10) {\n            showSeparator = true;\n          }\n        }\n\n        if (!nextMsg) {\n          showTime = true;\n        } else {\n          const sameMinute =\n            currentTime.getHours() === nextMsg.timestamp.getHours() &&\n            currentTime.getMinutes() === nextMsg.timestamp.getMinutes();\n          if (!sameMinute) {\n            showTime = true;\n          }\n        }\n\n        return (\n          <div key={message.id} className={cx(\"message-wrapper\", message.type)}>\n            {showSeparator && (\n              <div className={cx(\"time-separator\")}>\n                <div className={cx(\"time-separator-content\")}>\n                  {formatSeparator(message.timestamp)}\n                </div>\n              </div>\n            )}\n            <div className={cx(\"message\", message.type)}>\n              <div\n                className={cx(\"message-bubble\", {\n                  \"has-media\": message.temporaryImage || message.image || \n                              message.temporaryVideo || message.video || message.file,\n                  temporary: message.isTemporary,\n                  uploading: message.uploading,\n                })}\n              >\n                <MessageContent message={message} onImagePreview={onImagePreview} />\n              </div>\n              {showTime && (\n                <div className={cx(\"message-time\")}>{formatTime(message.timestamp)}</div>\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default MessagesList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}