{"ast":null,"code":"import React from\"react\";import classNames from\"classnames/bind\";import styles from\"./MessageContent.module.scss\";import{FileText}from\"lucide-react\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const cx=classNames.bind(styles);function MessageContent(_ref){let{message,onImagePreview}=_ref;const isValidUrl=url=>{try{new URL(url);return true;}catch(_unused){return false;}};const handleDownload=async(url,filename,e)=>{e.preventDefault();e.stopPropagation();try{const fileUrl=\"https://ichigomazone.s3.amazonaws.com/\".concat(url);console.log(\"Fetching:\",fileUrl);const response=await fetch(fileUrl);if(!response.ok){throw new Error(\"HTTP error! Status: \".concat(response.status));}const blob=await response.blob();const link=document.createElement(\"a\");link.href=window.URL.createObjectURL(blob);link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link);window.URL.revokeObjectURL(link.href);console.log(\"Download triggered for:\",filename);}catch(error){console.error(\"Tải xuống thất bại:\",error);}};// Handle uploading state\nif(message.uploading){return/*#__PURE__*/_jsxs(\"div\",{className:cx(\"message-uploading\"),children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0110ang t\\u1EA3i \",message.fileName,\"...\"]}),/*#__PURE__*/_jsx(\"div\",{className:cx(\"uploading-progress\"),children:/*#__PURE__*/_jsx(\"div\",{className:cx(\"progress-bar\")})})]});}// Handle error state\nif(message.error){return/*#__PURE__*/_jsx(\"div\",{className:cx(\"message-error\"),children:/*#__PURE__*/_jsxs(\"span\",{children:[\"L\\u1ED7i t\\u1EA3i \",message.fileName]})});}// Handle image content\nif(message.temporaryImage||message.image){const imageSource=message.temporaryImage||message.image;const isBase64=imageSource&&imageSource.startsWith(\"data:image/\");console.log(imageSource);return/*#__PURE__*/_jsxs(\"div\",{className:cx(\"message-image\",{temporary:message.isTemporary}),onClick:()=>onImagePreview(imageSource),\"aria-label\":\"Xem tr\\u01B0\\u1EDBc h\\xECnh \\u1EA3nh\",children:[/*#__PURE__*/_jsx(\"img\",{src:isBase64?imageSource:imageSource&&imageSource.startsWith(\"http\")?imageSource:\"https://ichigomazone.s3.amazonaws.com/\".concat(imageSource),alt:message.fileName||\"Hình ảnh được chia sẻ\",className:cx(\"image-content\"),onError:e=>{console.error(\"Lỗi tải hình ảnh:\",e.target.src);e.target.parentElement.style.display=\"none\";}}),message.uploading&&/*#__PURE__*/_jsx(\"div\",{className:cx(\"uploading-indicator\"),children:\"\\u0110ang t\\u1EA3i...\"})]});}// Handle video content\nif(message.temporaryVideo||message.video){const videoSource=message.temporaryVideo||message.video;const isBase64=videoSource&&videoSource.startsWith(\"data:video/\");return/*#__PURE__*/_jsxs(\"div\",{className:cx(\"message-video\",{temporary:message.isTemporary}),children:[/*#__PURE__*/_jsxs(\"video\",{controls:true,className:cx(\"video-content\"),children:[/*#__PURE__*/_jsx(\"source\",{src:isBase64?videoSource:videoSource&&videoSource.startsWith(\"http\")?videoSource:\"https://ichigomazone.s3.amazonaws.com/\".concat(videoSource),type:\"video/mp4\"}),\"Tr\\xECnh duy\\u1EC7t c\\u1EE7a b\\u1EA1n kh\\xF4ng h\\u1ED7 tr\\u1EE3 th\\u1EBB video.\"]}),message.uploading&&/*#__PURE__*/_jsx(\"div\",{className:cx(\"uploading-indicator\"),children:\"\\u0110ang t\\u1EA3i...\"})]});}// Handle file content\nif(message.file){const fileUrl=\"https://ichigomazone.s3.amazonaws.com/\".concat(message.file.url);console.log(\"FILE: \",message);return/*#__PURE__*/_jsx(\"div\",{className:cx(\"message-file\"),children:/*#__PURE__*/_jsxs(\"div\",{className:cx(\"file-container\"),children:[/*#__PURE__*/_jsx(\"div\",{className:cx(\"file-icon\"),children:/*#__PURE__*/_jsx(FileText,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{className:cx(\"file-info\"),children:[/*#__PURE__*/_jsx(\"div\",{className:cx(\"file-name\"),children:message.file.name}),message.file.url&&/*#__PURE__*/_jsx(\"a\",{href:fileUrl,className:cx(\"download-link\"),onClick:e=>handleDownload(message.file.url,message.file.name,e),children:\"T\\u1EA3i xu\\u1ED1ng\"})]})]})});}// Handle text content with URL parsing\nif(typeof message.text===\"string\"&&message.text){const urlRegex=/(https?:\\/\\/[^\\s]+)/g;const parts=message.text.split(urlRegex);return/*#__PURE__*/_jsx(\"span\",{children:parts.map((part,index)=>{if(part.match(urlRegex)&&isValidUrl(part)){return/*#__PURE__*/_jsx(\"a\",{href:part,target:\"_blank\",rel:\"noopener noreferrer\",className:cx(\"message-link\"),children:part},index);}return part;})});}return/*#__PURE__*/_jsx(\"span\",{children:message.text||\"\"});}export default MessageContent;","map":{"version":3,"names":["React","classNames","styles","FileText","jsxs","_jsxs","jsx","_jsx","cx","bind","MessageContent","_ref","message","onImagePreview","isValidUrl","url","URL","_unused","handleDownload","filename","e","preventDefault","stopPropagation","fileUrl","concat","console","log","response","fetch","ok","Error","status","blob","link","document","createElement","href","window","createObjectURL","download","body","appendChild","click","removeChild","revokeObjectURL","error","uploading","className","children","fileName","temporaryImage","image","imageSource","isBase64","startsWith","temporary","isTemporary","onClick","src","alt","onError","target","parentElement","style","display","temporaryVideo","video","videoSource","controls","type","file","size","name","text","urlRegex","parts","split","map","part","index","match","rel"],"sources":["/home/ichigomazone/Vscode/ReactJs/new-ui/frontend/src/components/Chat/MessageContent/MessageContent.js"],"sourcesContent":["import React from \"react\";\nimport classNames from \"classnames/bind\";\nimport styles from \"./MessageContent.module.scss\";\nimport { FileText } from \"lucide-react\";\n\nconst cx = classNames.bind(styles);\n\nfunction MessageContent({ message, onImagePreview }) {\n  const isValidUrl = (url) => {\n    try {\n      new URL(url);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\n  const handleDownload = async (url, filename, e) => {\n  e.preventDefault();\n  e.stopPropagation();\n\n  try {\n    const fileUrl = `https://ichigomazone.s3.amazonaws.com/${url}`;\n    console.log(\"Fetching:\", fileUrl);\n    const response = await fetch(fileUrl);\n    if (!response.ok) {\n      throw new Error(`HTTP error! Status: ${response.status}`);\n    }\n    const blob = await response.blob();\n    const link = document.createElement(\"a\");\n    link.href = window.URL.createObjectURL(blob);\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(link.href);\n    console.log(\"Download triggered for:\", filename);\n  } catch (error) {\n    console.error(\"Tải xuống thất bại:\", error);\n  }\n};\n\n  // Handle uploading state\n  if (message.uploading) {\n    return (\n      <div className={cx(\"message-uploading\")}>\n        <span>Đang tải {message.fileName}...</span>\n        <div className={cx(\"uploading-progress\")}>\n          <div className={cx(\"progress-bar\")}></div>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle error state\n  if (message.error) {\n    return (\n      <div className={cx(\"message-error\")}>\n        <span>Lỗi tải {message.fileName}</span>\n      </div>\n    );\n  }\n\n  // Handle image content\n  if (message.temporaryImage || message.image) {\n    const imageSource = message.temporaryImage || message.image;\n    const isBase64 = imageSource && imageSource.startsWith(\"data:image/\");\n\n    console.log(imageSource)\n\n    return (\n      <div\n        className={cx(\"message-image\", { temporary: message.isTemporary })}\n        onClick={() => onImagePreview(imageSource)}\n        aria-label=\"Xem trước hình ảnh\"\n      >\n        <img\n          src={\n            isBase64\n              ? imageSource\n              : imageSource && imageSource.startsWith(\"http\")\n              ? imageSource\n              : `https://ichigomazone.s3.amazonaws.com/${imageSource}`\n          }\n          alt={message.fileName || \"Hình ảnh được chia sẻ\"}\n          className={cx(\"image-content\")}\n          onError={(e) => {\n            console.error(\"Lỗi tải hình ảnh:\", e.target.src);\n            e.target.parentElement.style.display = \"none\";\n          }}\n        />\n        {message.uploading && (\n          <div className={cx(\"uploading-indicator\")}>\n            Đang tải...\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // Handle video content\n  if (message.temporaryVideo || message.video) {\n    const videoSource = message.temporaryVideo || message.video;\n    const isBase64 = videoSource && videoSource.startsWith(\"data:video/\");\n\n    return (\n      <div className={cx(\"message-video\", { temporary: message.isTemporary })}>\n        <video controls className={cx(\"video-content\")}>\n          <source\n            src={\n              isBase64\n                ? videoSource\n                : videoSource && videoSource.startsWith(\"http\")\n                ? videoSource\n                : `https://ichigomazone.s3.amazonaws.com/${videoSource}`\n            }\n            type=\"video/mp4\"\n          />\n          Trình duyệt của bạn không hỗ trợ thẻ video.\n        </video>\n        {message.uploading && (\n          <div className={cx(\"uploading-indicator\")}>\n            Đang tải...\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // Handle file content\n  if (message.file) {\n    const fileUrl = `https://ichigomazone.s3.amazonaws.com/${message.file.url}`;\n\n    console.log(\"FILE: \", message)\n\n    return (\n      <div className={cx(\"message-file\")}>\n        <div className={cx(\"file-container\")}>\n          <div className={cx(\"file-icon\")}>\n            <FileText size={20} />\n          </div>\n          <div className={cx(\"file-info\")}>\n            <div className={cx(\"file-name\")}>{message.file.name}</div>\n            {message.file.url && (\n              <a\n                href={fileUrl}\n                className={cx(\"download-link\")}\n                onClick={(e) => handleDownload(message.file.url, message.file.name, e)}\n              >\n                Tải xuống\n              </a>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle text content with URL parsing\n  if (typeof message.text === \"string\" && message.text) {\n    const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\n    const parts = message.text.split(urlRegex);\n    return (\n      <span>\n        {parts.map((part, index) => {\n          if (part.match(urlRegex) && isValidUrl(part)) {\n            return (\n              <a\n                key={index}\n                href={part}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className={cx(\"message-link\")}\n              >\n                {part}\n              </a>\n            );\n          }\n          return part;\n        })}\n      </span>\n    );\n  }\n\n  return <span>{message.text || \"\"}</span>;\n}\n\nexport default MessageContent;\n\n\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}